# chap5 基元类型、引用类型和值类型

1. 编程语言的基元类型

	基元类型是指编译器直接能理解并处理的类型，如
	+ System.Int32,
	+ System.Single,
	+ System.Double,
	+ System.Boolean,
	+ System.Byte,
	+ System.Char,
	
	编译器可以直接对基元类型做一些转换操作，如将Byte隐式转换为Int32，而当向下转型时由于可能会丢失精度，因此编译器要求进行显式转换。在这里我们可以通过**check**和**uncheck**语句来进行发生溢出时是否抛出异常的控制
	
1. 引用类型和值类型

	值类型对象被存储在线程栈上，
	引用类型的实际对象被存储在托管堆。
	
	当给一个需要引用类型的对象传递一个值类型对象时，clr会对值类型进行装箱操作(box)将值类型转换成引用类型
1. 值类型的装箱和拆箱  

	当对值类型对象进行装箱后会在托管堆上分配内存，并把值复制到堆内存
	
	拆箱时将值从堆内存复制到栈内存

1. 对象哈希码
	
	重写对象的Equals方法后，建议也重写GetHashCode方法，因为集合类型Hash，Dictionary，通过对象HashCode来计算要存储的位置、判断相等和查找对象，这意味修改集合中的一个键对象后，集合将找不到这个对象。所以正确修改集合中键对象的方式是先从集合中移除键值对，修改，再添加回集合。
1. dynamic基元类型
	
	dynamic类型是为了方便开发人员使用反射或是与其他组件通信而定义的。在使用时将表达式或变量定义为dynamic，并且调用字段、方法、索引、委托和操作符等，编译器为dynamic类型的表达式生成特殊的代码payload，payload会在运行时检查实际类型，根据实际类型来决定要进行的操作
	
	编译器不允许从Object类型到其他类型的隐式转换，但是允许Dynamic类型到其他类型的隐式转换。运行时,由clr进行类型检查
	
	编译器在生成payload时使用的类runtime binder被定义在Microsoft.CSharp.dll程序集中，clr在运行时加载这个程序集。这个程序集会在在运行时生成代码来判断针对实际类型采用最后的操作。而且Microsoft.CSharp.dll还会加载system.dll与system.core.dll，这会加大程序性能开销，在使用时需要注意，如果程序只有少量地方使用dynamic，我们可以考虑用传统方式来替代。